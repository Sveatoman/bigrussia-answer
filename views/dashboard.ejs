<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç ‚Äî BigRussiaAnswer</title>
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/css/dashboard.css">
  <link rel="stylesheet" href="/css/notifications.css">
</head>
<body>
  <div class="noise"></div>
  
  <header>
    <nav class="navbar">
      <a href="/" class="logo">
        <span class="logo-white">BigRussia</span><span class="logo-blue">Answer</span>
      </a>
      
      <ul class="nav-links">
        <li><a href="/">–ì–ª–∞–≤–Ω–∞—è</a></li>
        <li><a href="/#tasks">–ó–∞–¥–∞–Ω–∏—è</a></li>
        <li><a href="/dashboard">–ö–∞–±–∏–Ω–µ—Ç</a></li>
      </ul>
      
      <div class="nav-actions">
        <span style="color: var(--text-gray); margin-right: 16px;"><%= user.name %></span>
        <a href="/logout" class="btn-secondary">–í—ã—Ö–æ–¥</a>
      </div>
    </nav>
  </header>

  <main class="dashboard-container">
    <div class="container">
      <div class="dashboard-header">
        <h1>–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</h1>
        <p>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, <%= user.name %>!</p>
      </div>

      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-label">–ë–∞–ª–∞–Ω—Å</div>
          <div class="stat-value balance"><%= user.balance.toFixed(2) %> ‚ÇΩ</div>
        </div>
        
        <div class="stat-card">
          <div class="stat-label">–°–µ–≥–æ–¥–Ω—è –∑–∞—Ä–∞–±–æ—Ç–∞–Ω–æ</div>
          <div class="stat-value earned"><%= user.today_earned.toFixed(2) %> ‚ÇΩ</div>
        </div>
        
        <div class="stat-card">
          <div class="stat-label">–í—ã–ø–æ–ª–Ω–µ–Ω–æ –∑–∞–¥–∞–Ω–∏–π</div>
          <div class="stat-value"><%= user.tasks_completed %></div>
        </div>
        
        <div class="stat-card">
          <div class="stat-label">–£—Ä–æ–≤–µ–Ω—å –∞–∫–∫–∞—É–Ω—Ç–∞</div>
          <div class="stat-value" style="font-size: 24px;"><%= user.level %></div>
        </div>
      </div>

      <div class="dashboard-tabs">
        <button class="tab-btn active" data-tab="tasks">–ú–æ–∏ –∑–∞–¥–∞–Ω–∏—è</button>
        <button class="tab-btn" data-tab="accounts">–ú–æ–∏ –∞–∫–∫–∞—É–Ω—Ç—ã</button>
        <button class="tab-btn" data-tab="withdrawals">–í—ã–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤</button>
        <button class="tab-btn" data-tab="profile">–ü—Ä–æ—Ñ–∏–ª—å</button>
      </div>

      <div class="tab-content active" id="tasks-tab">
        <div class="task-list" id="myTasksList">
          <!-- Tasks will be loaded here -->
        </div>
      </div>

      <div class="tab-content" id="accounts-tab">
        <div style="max-width: 900px;">
          <div class="auth-card" style="margin-bottom: 32px;">
            <h3 style="margin-bottom: 16px;">‚ûï –î–æ–±–∞–≤–∏—Ç—å —Ä–∞–±–æ—á–∏–π –∞–∫–∫–∞—É–Ω—Ç</h3>
            <p style="color: var(--text-gray); margin-bottom: 24px; font-size: 14px;">
              –î–æ–±–∞–≤—å—Ç–µ –∞–∫–∫–∞—É–Ω—Ç—ã, —Å –∫–æ—Ç–æ—Ä—ã—Ö –≤—ã –ø–∏—à–µ—Ç–µ –æ—Ç–∑—ã–≤—ã. –ü–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–æ–º –≤—ã —Å–º–æ–∂–µ—Ç–µ –≤—ã–ø–æ–ª–Ω—è—Ç—å –∑–∞–¥–∞–Ω–∏—è.
            </p>
            
            <div style="background: rgba(47, 128, 255, 0.1); border-left: 3px solid var(--primary-blue); padding: 16px; margin-bottom: 24px; border-radius: 8px;">
              <div style="font-weight: 600; margin-bottom: 8px; color: var(--primary-blue);">üìñ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—é –∞–∫–∫–∞—É–Ω—Ç–æ–≤</div>
              <a href="https://telegra.ph/Kak-sozdat-akkaunt-02-19-2" target="_blank" style="color: var(--primary-blue); text-decoration: none; font-size: 14px;">
                –ü—Ä–æ—á–∏—Ç–∞–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é –ø–µ—Ä–µ–¥ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º ‚Üí
              </a>
            </div>
            
            <form id="addAccountForm">
              <div class="form-group">
                <label>–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞</label>
                <select name="platform" required style="width: 100%; background: rgba(255, 255, 255, 0.05); border: 1px solid var(--border-subtle); border-radius: 12px; padding: 14px 16px; color: var(--text-light); font-size: 16px;">
                  <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—É</option>
                  <option value="–Ø–Ω–¥–µ–∫—Å.–ö–∞—Ä—Ç—ã">–Ø–Ω–¥–µ–∫—Å.–ö–∞—Ä—Ç—ã</option>
                  <option value="Google Maps">Google Maps</option>
                  <option value="2–ì–ò–°">2–ì–ò–°</option>
                  <option value="Wildberries">Wildberries</option>
                  <option value="Ozon">Ozon</option>
                  <option value="–í–ö–æ–Ω—Ç–∞–∫—Ç–µ">–í–ö–æ–Ω—Ç–∞–∫—Ç–µ</option>
                  <option value="Telegram">Telegram</option>
                  <option value="YouTube">YouTube</option>
                  <option value="–î—Ä—É–≥–æ–µ">–î—Ä—É–≥–æ–µ</option>
                </select>
              </div>
              
              <div class="form-group">
                <label>–ò–º—è –∞–∫–∫–∞—É–Ω—Ç–∞</label>
                <input type="text" name="account_name" required placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤">
              </div>
              
              <div class="form-group">
                <label>–°—Å—ã–ª–∫–∞ –Ω–∞ –ø—Ä–æ—Ñ–∏–ª—å</label>
                <input type="url" name="account_link" required placeholder="https://...">
              </div>
              
              <div class="form-group">
                <label>–°–∫—Ä–∏–Ω—à–æ—Ç –ø—Ä–æ—Ñ–∏–ª—è (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
                <input type="file" name="screenshot" accept="image/*" required style="color: var(--text-light);">
                <small style="color: var(--text-gray); display: block; margin-top: 8px;">
                  –°–¥–µ–ª–∞–π—Ç–µ —Å–∫—Ä–∏–Ω—à–æ—Ç –≤–∞—à–µ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è —Å –≤–∏–¥–∏–º—ã–º –∏–º–µ–Ω–µ–º –∏ –∞–≤–∞—Ç–∞—Ä–æ–º
                </small>
              </div>
              
              <div class="form-group">
                <label>–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</label>
                <textarea name="proof_text" placeholder="–£–∫–∞–∂–∏—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–µ—Ç–∞–ª–∏..." style="width: 100%; background: rgba(255, 255, 255, 0.05); border: 1px solid var(--border-subtle); border-radius: 12px; padding: 14px 16px; color: var(--text-light); font-family: inherit; resize: vertical; min-height: 80px;"></textarea>
              </div>
              
              <button type="submit" class="btn-primary">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É</button>
            </form>
          </div>

          <div class="auth-card">
            <h3 style="margin-bottom: 24px;">üìã –ú–æ–∏ —Ä–∞–±–æ—á–∏–µ –∞–∫–∫–∞—É–Ω—Ç—ã</h3>
            <div id="workAccountsList">
              <!-- Accounts will be loaded here -->
            </div>
          </div>
        </div>
      </div>

      <div class="tab-content" id="withdrawals-tab">
        <div style="max-width: 800px;">
          <div class="auth-card" style="margin-bottom: 32px;">
            <h3 style="margin-bottom: 24px;">–í—ã–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤</h3>
            <p style="color: var(--text-gray); margin-bottom: 24px;">
              –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ –¥–ª—è –≤—ã–≤–æ–¥–∞: 50 ‚ÇΩ<br>
              –î–æ—Å—Ç—É–ø–Ω–æ –¥–ª—è –≤—ã–≤–æ–¥–∞: <strong style="color: var(--success-green);"><%= user.balance.toFixed(2) %> ‚ÇΩ</strong>
            </p>
            
            <form id="withdrawalForm">
              <div class="form-group">
                <label>–°—É–º–º–∞</label>
                <input type="number" name="amount" min="50" max="<%= user.balance %>" required placeholder="50">
              </div>
              
              <div class="form-group">
                <label>–°–ø–æ—Å–æ–± –≤—ã–≤–æ–¥–∞</label>
                <select name="method" style="width: 100%; background: rgba(255, 255, 255, 0.05); border: 1px solid var(--border-subtle); border-radius: 12px; padding: 14px 16px; color: var(--text-light); font-size: 16px;">
                  <option value="lolz">Lolz</option>
                  <option value="crypto">–ö—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–∞</option>
                </select>
              </div>
              
              <div class="form-group">
                <label>–†–µ–∫–≤–∏–∑–∏—Ç—ã</label>
                <input type="text" name="details" required placeholder="–ù–æ–º–µ—Ä –∫–∞—Ä—Ç—ã / —Ç–µ–ª–µ—Ñ–æ–Ω–∞ / –∫–æ—à–µ–ª—å–∫–∞">
              </div>
              
              <button type="submit" class="btn-primary">–ó–∞–∫–∞–∑–∞—Ç—å –≤—ã–ø–ª–∞—Ç—É</button>
            </form>
          </div>

          <div class="auth-card">
            <h3 style="margin-bottom: 24px;">–ò—Å—Ç–æ—Ä–∏—è –≤—ã–ø–ª–∞—Ç</h3>
            <div id="withdrawalsList">
              <!-- Withdrawals will be loaded here -->
            </div>
          </div>
        </div>
      </div>

      <div class="tab-content" id="profile-tab">
        <div class="auth-card" style="max-width: 600px; margin: 0;">
          <h3 style="margin-bottom: 24px;">–ü—Ä–æ—Ñ–∏–ª—å</h3>
          <div class="form-group">
            <label>–ò–º—è</label>
            <input type="text" value="<%= user.name %>" readonly>
          </div>
          <div class="form-group">
            <label>Email</label>
            <input type="email" value="<%= user.email %>" readonly>
          </div>
          <div class="form-group">
            <label>–í—Å–µ–≥–æ –∑–∞—Ä–∞–±–æ—Ç–∞–Ω–æ</label>
            <input type="text" value="<%= user.total_earned.toFixed(2) %> ‚ÇΩ" readonly>
          </div>
        </div>
      </div>
    </div>
  </main>

  <script src="/js/notifications.js"></script>
  <script>
    const userBalance = parseFloat('<%= user.balance %>');
    
    // Tab switching
    document.querySelectorAll('.tab-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        
        btn.classList.add('active');
        document.getElementById(btn.dataset.tab + '-tab').classList.add('active');
      });
    });

    // Load my tasks
    async function loadMyTasks() {
      try {
        const response = await fetch('/api/my-tasks');
        const tasks = await response.json();
        
        const list = document.getElementById('myTasksList');
        
        if (tasks.length === 0) {
          list.innerHTML = '<p style="text-align: center; color: var(--text-gray); padding: 40px;">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∑–∞–¥–∞–Ω–∏–π. <a href="/#tasks" style="color: var(--primary-blue);">–í—ã–±—Ä–∞—Ç—å –∑–∞–¥–∞–Ω–∏–µ</a></p>';
          return;
        }
        
        list.innerHTML = tasks.map(task => `
          <div class="task-item">
            <div class="task-item-header">
              <div>
                <div class="task-item-title">${task.title}</div>
              </div>
              <span class="task-status ${task.status}">${getStatusText(task.status)}</span>
            </div>
            
            <p class="task-item-description">${task.description}</p>
            
            ${task.instructions ? `<div class="task-instructions"><strong>–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è:</strong><br>${task.instructions}</div>` : ''}
            
            <div style="color: var(--success-green); font-weight: 700; font-size: 18px; margin-bottom: 12px;">
              –ù–∞–≥—Ä–∞–¥–∞: +${task.reward} ‚ÇΩ
            </div>
            
            ${task.status === null || task.status === 'rejected' ? `
              <form class="submission-form" onsubmit="submitTask(event, ${task.id})" id="form-${task.id}">
                <textarea name="proof_text" placeholder="–û–ø–∏—à–∏—Ç–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è, –≤—Å—Ç–∞–≤—å—Ç–µ —Å—Å—ã–ª–∫–∏..." required></textarea>
                
                <div class="file-upload-area" onclick="document.getElementById('file-input-${task.id}').click()" 
                     ondragover="handleDragOver(event)" 
                     ondragleave="handleDragLeave(event)"
                     ondrop="handleDrop(event, ${task.id})">
                  <div class="file-upload-icon">üìé</div>
                  <div class="file-upload-text">–ù–∞–∂–º–∏—Ç–µ –∏–ª–∏ –ø–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Å–∫—Ä–∏–Ω—à–æ—Ç—ã —Å—é–¥–∞</div>
                  <div class="file-upload-hint">–î–æ 5 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (PNG, JPG, JPEG)</div>
                </div>
                
                <input type="file" 
                       id="file-input-${task.id}" 
                       class="hidden-file-input" 
                       accept="image/*" 
                       multiple 
                       onchange="handleFileSelect(event, ${task.id})">
                
                <div id="preview-${task.id}" class="file-preview-container"></div>
                
                <button type="submit" class="btn-primary btn-small">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É</button>
              </form>
            ` : ''}
            
            ${task.status === 'pending' ? '<p style="color: var(--text-gray); margin-top: 12px;">‚è≥ –û–∂–∏–¥–∞–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–æ–º</p>' : ''}
            
            ${task.status === 'approved' ? '<p style="color: var(--success-green); margin-top: 12px;">‚úì –ó–∞–¥–∞–Ω–∏–µ –æ–¥–æ–±—Ä–µ–Ω–æ, –Ω–∞–≥—Ä–∞–¥–∞ –Ω–∞—á–∏—Å–ª–µ–Ω–∞</p>' : ''}
            
            ${task.admin_comment ? `<div class="admin-comment"><strong>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–∞:</strong><br>${task.admin_comment}</div>` : ''}
          </div>
        `).join('');
      } catch (error) {
        console.error('Error loading tasks:', error);
      }
    }

    // File upload handling
    const filesByTask = {};

    function handleFileSelect(event, taskId) {
      const files = Array.from(event.target.files);
      addFiles(taskId, files);
    }

    function handleDragOver(event) {
      event.preventDefault();
      event.currentTarget.classList.add('drag-over');
    }

    function handleDragLeave(event) {
      event.currentTarget.classList.remove('drag-over');
    }

    function handleDrop(event, taskId) {
      event.preventDefault();
      event.currentTarget.classList.remove('drag-over');
      
      const files = Array.from(event.dataTransfer.files).filter(f => f.type.startsWith('image/'));
      addFiles(taskId, files);
    }

    function addFiles(taskId, newFiles) {
      if (!filesByTask[taskId]) {
        filesByTask[taskId] = [];
      }
      
      // Limit to 5 files
      const remainingSlots = 5 - filesByTask[taskId].length;
      const filesToAdd = newFiles.slice(0, remainingSlots);
      
      if (newFiles.length > remainingSlots) {
        showWarning(`–ú–æ–∂–Ω–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å –º–∞–∫—Å–∏–º—É–º 5 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π. –î–æ–±–∞–≤–ª–µ–Ω–æ: ${filesToAdd.length}`);
      }
      
      filesByTask[taskId].push(...filesToAdd);
      renderFilePreviews(taskId);
    }

    function removeFile(taskId, index) {
      filesByTask[taskId].splice(index, 1);
      renderFilePreviews(taskId);
    }

    function renderFilePreviews(taskId) {
      const container = document.getElementById(`preview-${taskId}`);
      if (!container) return;
      
      const files = filesByTask[taskId] || [];
      
      if (files.length === 0) {
        container.innerHTML = '';
        return;
      }
      
      container.innerHTML = files.map((file, index) => {
        const url = URL.createObjectURL(file);
        return `
          <div class="file-preview-item">
            <img src="${url}" alt="${file.name}">
            <button type="button" class="file-preview-remove" onclick="removeFile(${taskId}, ${index})">√ó</button>
            <div class="file-preview-name">${file.name}</div>
          </div>
        `;
      }).join('');
    }

    async function submitTask(event, submissionId) {
      event.preventDefault();
      
      const formData = new FormData(event.target);
      
      // Add all files
      const files = filesByTask[submissionId] || [];
      files.forEach(file => {
        formData.append('proof_images', file);
      });
      
      try {
        const response = await fetch(`/api/submissions/${submissionId}/submit`, {
          method: 'POST',
          body: formData
        });
        
        const data = await response.json();
        
        if (data.success) {
          showSuccess('–ó–∞–¥–∞–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É!');
          filesByTask[submissionId] = []; // Clear files
          setTimeout(() => loadMyTasks(), 1000);
        } else {
          showError('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ');
        }
      } catch (error) {
        showError('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ');
      }
    }

    function getStatusText(status) {
      const statuses = {
        'pending': '–ù–∞ –ø—Ä–æ–≤–µ—Ä–∫–µ',
        'approved': '–û–¥–æ–±—Ä–µ–Ω–æ',
        'rejected': '–û—Ç–∫–ª–æ–Ω–µ–Ω–æ',
        null: '–ù–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ'
      };
      return statuses[status] || '–ù–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ';
    }

    // Withdrawal form
    document.getElementById('withdrawalForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const formData = new FormData(e.target);
      const data = Object.fromEntries(formData);
      
      if (parseFloat(data.amount) > userBalance) {
        showWarning('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤ –Ω–∞ –±–∞–ª–∞–Ω—Å–µ');
        return;
      }
      
      if (parseFloat(data.amount) < 50) {
        showWarning('–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ –≤—ã–≤–æ–¥–∞ 50 ‚ÇΩ');
        return;
      }
      
      try {
        const response = await fetch('/api/withdrawals', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });
        
        const result = await response.json();
        
        if (result.success) {
          showSuccess('–ó–∞—è–≤–∫–∞ –Ω–∞ –≤—ã–≤–æ–¥ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞! –û–∂–∏–¥–∞–π—Ç–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º.');
          e.target.reset();
          loadWithdrawals();
          setTimeout(() => location.reload(), 2000);
        } else {
          showError(result.error || '–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞—è–≤–∫–∏');
        }
      } catch (error) {
        showError('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞—è–≤–∫–∏');
      }
    });

    // Load withdrawals
    async function loadWithdrawals() {
      try {
        const response = await fetch('/api/my-withdrawals');
        const withdrawals = await response.json();
        
        const list = document.getElementById('withdrawalsList');
        
        if (withdrawals.length === 0) {
          list.innerHTML = '<p style="text-align: center; color: var(--text-gray); padding: 20px;">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∑–∞—è–≤–æ–∫ –Ω–∞ –≤—ã–≤–æ–¥</p>';
          return;
        }
        
        list.innerHTML = withdrawals.map(w => `
          <div style="border-bottom: 1px solid var(--border-subtle); padding: 16px 0;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
              <div>
                <strong style="font-size: 18px;">${w.amount} ‚ÇΩ</strong>
                <span style="color: var(--text-gray); margin-left: 12px;">${getMethodName(w.method)}</span>
              </div>
              <span class="task-status ${w.status}">${getWithdrawalStatus(w.status)}</span>
            </div>
            <div style="color: var(--text-gray); font-size: 14px;">
              ${new Date(w.created_at).toLocaleString('ru-RU')}
            </div>
          </div>
        `).join('');
      } catch (error) {
        console.error('Error loading withdrawals:', error);
      }
    }

    function getMethodName(method) {
      const methods = {
        'lolz': 'Lolz',
        'crypto': '–ö—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–∞'
      };
      return methods[method] || method;
    }

    function getWithdrawalStatus(status) {
      const statuses = {
        'pending': '–ù–∞ –ø—Ä–æ–≤–µ—Ä–∫–µ',
        'approved': '–í—ã–ø–ª–∞—á–µ–Ω–æ',
        'rejected': '–û—Ç–∫–ª–æ–Ω–µ–Ω–æ'
      };
      return statuses[status] || status;
    }

    loadMyTasks();
    loadWithdrawals();
    loadWorkAccounts();

    // Add work account form
    document.getElementById('addAccountForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const formData = new FormData(e.target);
      
      try {
        const response = await fetch('/api/work-accounts', {
          method: 'POST',
          body: formData
        });
        
        const result = await response.json();
        
        if (result.success) {
          showSuccess('–ê–∫–∫–∞—É–Ω—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É!');
          e.target.reset();
          setTimeout(() => loadWorkAccounts(), 1000);
        } else {
          showError(result.error || '–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –∞–∫–∫–∞—É–Ω—Ç–∞');
        }
      } catch (error) {
        showError('–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –∞–∫–∫–∞—É–Ω—Ç–∞');
      }
    });

    // Load work accounts
    async function loadWorkAccounts() {
      try {
        const response = await fetch('/api/my-work-accounts');
        const accounts = await response.json();
        
        const list = document.getElementById('workAccountsList');
        
        if (accounts.length === 0) {
          list.innerHTML = '<p style="text-align: center; color: var(--text-gray); padding: 20px;">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö –∞–∫–∫–∞—É–Ω—Ç–æ–≤</p>';
          return;
        }
        
        list.innerHTML = accounts.map(acc => `
          <div style="border-bottom: 1px solid var(--border-subtle); padding: 16px 0;">
            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 12px;">
              <div>
                <div style="font-weight: 600; font-size: 16px; margin-bottom: 4px;">${acc.platform}</div>
                <div style="color: var(--text-gray); font-size: 14px; margin-bottom: 4px;">${acc.account_name}</div>
                <a href="${acc.account_link}" target="_blank" style="color: var(--primary-blue); font-size: 13px; text-decoration: none;">–û—Ç–∫—Ä—ã—Ç—å –ø—Ä–æ—Ñ–∏–ª—å ‚Üí</a>
              </div>
              <span class="task-status ${acc.status}">${getAccountStatus(acc.status)}</span>
            </div>
            
            ${acc.screenshot ? `<div style="margin-bottom: 8px;"><img src="/uploads/${acc.screenshot}" style="max-width: 200px; border-radius: 8px; border: 1px solid var(--border-subtle);" alt="Screenshot"></div>` : ''}
            
            ${acc.status === 'approved' && acc.cooldown_until ? getCooldownInfo(acc.cooldown_until) : ''}
            
            ${acc.admin_comment ? `<div class="admin-comment" style="margin-top: 12px;"><strong>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–∞:</strong><br>${acc.admin_comment}</div>` : ''}
            
            <div style="color: var(--text-gray); font-size: 12px; margin-top: 8px;">
              –î–æ–±–∞–≤–ª–µ–Ω: ${new Date(acc.created_at).toLocaleString('ru-RU')}
              ${acc.last_used_at ? `<br>–ü–æ—Å–ª–µ–¥–Ω–µ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: ${new Date(acc.last_used_at).toLocaleString('ru-RU')}` : ''}
            </div>
            
            ${acc.status === 'rejected' ? `
              <button class="btn-reject btn-small" onclick="deleteAccount(${acc.id})" style="margin-top: 12px;">–£–¥–∞–ª–∏—Ç—å</button>
            ` : ''}
          </div>
        `).join('');
      } catch (error) {
        console.error('Error loading work accounts:', error);
      }
    }

    function getCooldownInfo(cooldownUntil) {
      const cooldownEnd = new Date(cooldownUntil);
      const now = new Date();
      
      if (cooldownEnd <= now) {
        return '<div style="background: rgba(39, 174, 96, 0.1); border-left: 3px solid var(--success-green); padding: 12px; margin-top: 12px; border-radius: 4px; font-size: 14px; color: var(--success-green);">‚úì –î–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è</div>';
      }
      
      const hoursLeft = Math.ceil((cooldownEnd - now) / (1000 * 60 * 60));
      const minutesLeft = Math.ceil((cooldownEnd - now) / (1000 * 60)) % 60;
      
      return `<div style="background: rgba(255, 193, 7, 0.1); border-left: 3px solid #FFC107; padding: 12px; margin-top: 12px; border-radius: 4px; font-size: 14px; color: #FFC107;">‚è± –í –∫—É–ª–¥–∞—É–Ω–µ. –î–æ—Å—Ç—É–ø–µ–Ω —á–µ—Ä–µ–∑: ${hoursLeft} —á. ${minutesLeft} –º–∏–Ω.</div>`;
    }

    function getAccountStatus(status) {
      const statuses = {
        'pending': '–ù–∞ –ø—Ä–æ–≤–µ—Ä–∫–µ',
        'approved': '–û–¥–æ–±—Ä–µ–Ω',
        'rejected': '–û—Ç–∫–ª–æ–Ω–µ–Ω'
      };
      return statuses[status] || status;
    }

    async function deleteAccount(accountId) {
      if (!confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –∞–∫–∫–∞—É–Ω—Ç?')) return;
      
      try {
        const response = await fetch(`/api/work-accounts/${accountId}`, {
          method: 'DELETE'
        });
        
        const result = await response.json();
        
        if (result.success) {
          showSuccess('–ê–∫–∫–∞—É–Ω—Ç —É–¥–∞–ª–µ–Ω');
          setTimeout(() => loadWorkAccounts(), 1000);
        } else {
          showError('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏');
        }
      } catch (error) {
        showError('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏');
      }
    }
  </script>
</body>
</html>
